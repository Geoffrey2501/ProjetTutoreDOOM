# Diagramme Synchronisation Multijoueur - Peer-to-Peer (P2P)

---

## Architecture Peer-to-Peer

```
        Client 1 (Host + Joueur)
               â”Œâ”€â”€â”€â”€â”€â”
               â”‚ ğŸ   â”‚ â† Coordinateur
               â””â”€â”€â”¬â”€â”€â”˜    + Joueur normal
                  â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚         â”‚         â”‚
     â”Œâ”€â”€â–¼â”€â”€â”   â”Œâ”€â”€â–¼â”€â”€â”   â”Œâ”€â”€â–¼â”€â”€â”
     â”‚  2  â”‚â—„â”€â”€â”¤  3  â”‚â”€â”€â–ºâ”‚  4  â”‚
     â””â”€â”€â”¬â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”¬â”€â”€â”˜
        â”‚                   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        
â€¢ Connexions : maillage complet (6 liens pour 4 joueurs)
â€¢ Communication : directe entre tous les pairs
â€¢ AutoritÃ© : Host pour dÃ©cisions globales uniquement

```

---

## Ã‰tablissement de connexion P2P

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client 1 â”‚         â”‚ Client 2 â”‚         â”‚ Client 3 â”‚
â”‚  (Host)  â”‚         â”‚          â”‚         â”‚          â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
      â”‚                    â”‚                    â”‚
      â”‚ CrÃ©e partie        â”‚                    â”‚
      â”‚ + GÃ©nÃ¨re seed      â”‚                    â”‚
      â”‚ Port: 25565        â”‚                    â”‚
      â”‚ IP: 192.168.1.10   â”‚                    â”‚
      â”‚                    â”‚                    â”‚
      â”‚                    â”‚ JOIN_REQUEST       â”‚
      â”‚                    â”‚ {pseudo:"Alice",   â”‚
      â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  version:"1.0"}    â”‚
      â”‚                    â”‚                    â”‚
      â”‚ Handshake OK       â”‚                    â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                    â”‚
      â”‚                    â”‚                    â”‚
      â”‚ MAP_DATA           â”‚                    â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                    â”‚
      â”‚ {seed:12345,       â”‚                    â”‚
      â”‚  worldData:...,    â”‚                    â”‚
      â”‚  spawnPoint:(0,64)}â”‚                    â”‚
      â”‚                    â”‚                    â”‚
      â”‚                    â”‚ GÃ©nÃ¨re map locale  â”‚
      â”‚                    â”‚ avec seed          â”‚
      â”‚                    â”‚                    â”‚
      â”‚                    â”‚                    â”‚ JOIN_REQUEST
      â”‚                    â”‚                    â”‚ {pseudo:"Bob",
      â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  version:"1.0"}
      â”‚                    â”‚                    â”‚
      â”‚ Handshake OK       â”‚                    â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚
      â”‚                    â”‚                    â”‚
      â”‚ MAP_DATA + PEERS   â”‚                    â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚
      â”‚ {seed:12345,       â”‚                    â”‚
      â”‚  worldData:...,    â”‚                    â”‚
      â”‚  existingPeers:[   â”‚                    â”‚
      â”‚   {id:2,           â”‚                    â”‚
      â”‚    pseudo:"Alice", â”‚                    â”‚
      â”‚    ip:"192.168.1.11",                   â”‚
      â”‚    port:25566}     â”‚                    â”‚
      â”‚  ]}                â”‚                    â”‚
      â”‚                    â”‚                    â”‚
      â”‚ NEW_PEER           â”‚                    â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                    â”‚
      â”‚ {id:3,             â”‚                    â”‚
      â”‚  pseudo:"Bob",     â”‚                    â”‚
      â”‚  ip:"192.168.1.12",â”‚                    â”‚
      â”‚  port:25567}       â”‚                    â”‚
      â”‚                    â”‚                    â”‚
      â”‚                    â”‚ PEER_CONNECT       â”‚
      â”‚                    â”‚ {id:2,             â”‚
      â”‚                    â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  pseudo:"Alice"}
      â”‚                    â”‚                    â”‚
      â”‚                    â”‚ ACK + Handshake    â”‚
      â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
      â”‚                    â”‚                    â”‚
      â”‚                    â”‚ Connexion J2â†”J3    â”‚
      â”‚                    â”‚ Ã©tablie âœ…         â”‚
      â”‚                    â”‚                    â”‚
      â”‚      MAILLAGE COMPLET Ã‰TABLI            â”‚
      â”‚                    â”‚                    â”‚
      â”‚ Tous les pairs connectÃ©s entre eux:     â”‚
      â”‚   â€¢ J1 â†” J2       âœ…                    â”‚
      â”‚   â€¢ J1 â†” J3       âœ…                    â”‚
      â”‚   â€¢ J2 â†” J3       âœ…                    â”‚
      â”‚                    â”‚                    â”‚
      â–¼                    â–¼                    â–¼

```

---

## Synchronisation des mouvements (P2P)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client 1 â”‚         â”‚ Client 2 â”‚         â”‚ Client 3 â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
      â”‚                    â”‚                    â”‚
      â”‚                    â”‚ [Appuie Z]         â”‚
      â”‚                    â”‚                    â”‚
      â”‚                    â”‚ Mouvement local    â”‚
      â”‚                    â”‚ immÃ©diat           â”‚
      â”‚                    â”‚                    â”‚
      â”‚ BROADCAST Ã©tat     â”‚                    â”‚
      â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
      â”‚ {id:2,             â”‚                    â”‚
      â”‚  pos:(x',y'),      â”‚                    â”‚
      â”‚  seq:42}           â”‚                    â”‚
      â”‚                    â”‚                    â”‚
      â”‚ MAJ position J2    â”‚                    â”‚ MAJ position J2
      â”‚                    â”‚                    â”‚
      â”‚                    â”‚                    â”‚
      â”‚ Broadcast J1       â”‚                    â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
      â”‚ {id:1, pos:(a,b),  â”‚                    â”‚
      â”‚  seq:78}           â”‚                    â”‚
      â”‚                    â”‚                    â”‚
      â”‚                    â”‚ MAJ J1             â”‚ MAJ J1
      â”‚                    â”‚                    â”‚
      â–¼                    â–¼                    â–¼
      
      Chaque client Ã©met ~30-60 fois/seconde
```

---

## Gestion des conflits (P2P)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client 1 â”‚         â”‚ Client 2 â”‚         â”‚ Client 3 â”‚
â”‚  (Host)  â”‚         â”‚ (Cible)  â”‚         â”‚ (TÃ©moin) â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
      â”‚                    â”‚                    â”‚
      â”‚ [J1 tire sur J2]   â”‚                    â”‚
      â”‚                    â”‚                    â”‚
      â”‚ PrÃ©diction locale  â”‚                    â”‚
      â”‚ Affichage HIT âœ…   â”‚                    â”‚
      â”‚                    â”‚                    â”‚
      â”‚ BROADCAST          â”‚                    â”‚
      â”‚ SHOOT_REQUEST      â”‚                    â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
      â”‚ {shooter:1,        â”‚                    â”‚
      â”‚  target:2,         â”‚                    â”‚
      â”‚  weapon:RIFLE,     â”‚                    â”‚
      â”‚  seq:100}          â”‚                    â”‚
      â”‚                    â”‚                    â”‚
      â”‚                    â”‚ PrÃ©diction locale  â”‚ PrÃ©diction locale
      â”‚                    â”‚ (optionnelle)      â”‚ (optionnelle)
      â”‚                    â”‚ Affichage rapide   â”‚ Affichage rapide
      â”‚                    â”‚                    â”‚
      â”‚ CALCUL AUTORITAIRE â”‚                    â”‚
      â”‚ (Host uniquement)  â”‚                    â”‚
      â”‚ â€¢ VÃ©rif collision  â”‚                    â”‚
      â”‚ â€¢ Calcul dÃ©gÃ¢ts    â”‚                    â”‚
      â”‚ â€¢ Validation       â”‚                    â”‚
      â”‚                    â”‚                    â”‚
      â”‚ BROADCAST          â”‚                    â”‚
      â”‚ DAMAGE_RESULT      â”‚                    â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
      â”‚ {target:2,         â”‚                    â”‚
      â”‚  damage:20,        â”‚                    â”‚
      â”‚  hp:80,            â”‚                    â”‚
      â”‚  valid:true,       â”‚                    â”‚
      â”‚  seq:100}          â”‚                    â”‚
      â”‚                    â”‚                    â”‚
      â”‚ MAJ Ã©tat final     â”‚ MAJ Ã©tat final     â”‚ MAJ Ã©tat final
      â”‚                    â”‚ HP = 80 âœ…         â”‚ HP = 80 âœ…
      â”‚                    â”‚                    â”‚
      â”‚                    â”‚ Correction si      â”‚ Correction si
      â”‚                    â”‚ prÃ©diction         â”‚ prÃ©diction
      â”‚                    â”‚ diffÃ©rente         â”‚ diffÃ©rente
      â”‚                    â”‚                    â”‚
      â–¼                    â–¼                    â–¼


    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    â•‘  RÃˆGLE DE RÃ‰SOLUTION DES CONFLITS                 â•‘
    â•‘                                                   â•‘
    â•‘  ğŸ  LE HOST EST L'AUTORITÃ‰ FINALE                â•‘
    â•‘                                                   â•‘
    â•‘  1. Tous les clients peuvent prÃ©dire localement  â•‘
    â•‘     pour un retour visuel immÃ©diat               â•‘
    â•‘                                                   â•‘
    â•‘  2. Seul le Host calcule le rÃ©sultat officiel    â•‘
    â•‘     (collisions, dÃ©gÃ¢ts, HP, etc.)               â•‘
    â•‘                                                   â•‘
    â•‘  3. Le Host envoie DAMAGE_RESULT Ã  tous          â•‘
    â•‘     â†’ Ce message fait autoritÃ©                   â•‘
    â•‘                                                   â•‘
    â•‘  4. Tous les clients synchronisent leur Ã©tat     â•‘
    â•‘     avec le rÃ©sultat du Host                     â•‘
    â•‘                                                   â•‘
    â•‘  âš ï¸  En cas de dÃ©saccord entre prÃ©diction       â•‘
    â•‘     locale et rÃ©sultat Host :                    â•‘
    â•‘     â†’ Le rÃ©sultat du Host remplace TOUJOURS     â•‘
    â•‘                                                   â•‘
    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


    Exemple de correction :

    J3 prÃ©dit : HIT â†’ damage:25, hp:75
    Host dÃ©cide : MISS â†’ damage:0, hp:100

    âœ J3 corrige son Ã©tat local avec hp:100

```

---

## Migration du Host (dÃ©connexion)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client 1 â”‚             â”‚ Client 2 â”‚             â”‚ Client 3 â”‚
â”‚  (Host)  â”‚             â”‚  (id:2)  â”‚             â”‚  (id:3)  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚                        â”‚                        â”‚
     â”‚   DÃ©connexion brutale  â”‚                        â”‚
     â”‚   du Host              â”‚                        â”‚
     â”‚         âœ–              â”‚                        â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€Xâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                        â”‚
     â”‚                        â”‚                        â”‚
     â”‚                        â”‚   DÃ©tection timeout    â”‚
     â”‚                        â”‚   (3 secondes)         â”‚
     â”‚                        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
     â”‚                        â”‚   DÃ©tection timeout    â”‚
     â”‚                        â”‚   (3 secondes)         â”‚
     â”‚                        â”‚                        â”‚
     â”‚    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
     â”‚    â•‘              PÃ‰RIODE DE TRANSITION                 â•‘
     â”‚    â•‘  â€¢ Actions critiques mises en attente              â•‘
     â”‚    â•‘  â€¢ Mouvements locaux continuent                   â•‘
     â”‚    â•‘  â€¢ DurÃ©e : ~3â€“5 secondes                          â•‘
     â”‚    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     â”‚                        â”‚                        â”‚
     â”‚                        â”‚  Ã‰LECTION automatique  â”‚
     â”‚                        â”‚  (rÃ¨gle dÃ©terministe)  â”‚
     â”‚                        â”‚                        â”‚
     â”‚                        â”‚  ID le plus bas        â”‚
     â”‚                        â”‚  devient Host          â”‚
     â”‚                        â”‚                        â”‚
     â”‚                        â”‚  J2 (id:2) < J3 (id:3) â”‚
     â”‚                        â”‚  â‡’ J2 = nouveau Host   â”‚
     â”‚                        â”‚                        â”‚
     â”‚                        â”‚  BROADCAST NEW_HOST    â”‚
     â”‚                        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
     â”‚                        â”‚ {event: NEW_HOST,      â”‚
     â”‚                        â”‚  hostId: 2,            â”‚
     â”‚                        â”‚  timestamp: ...}       â”‚
     â”‚                        â”‚                        â”‚
     â”‚                        â”‚      ACK + Sync        â”‚
     â”‚                        â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚                        â”‚                        â”‚
     â”‚                        â”‚  Synchronisation       â”‚
     â”‚                        â”‚  de lâ€™Ã©tat du jeu      â”‚
     â”‚                        â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
     â”‚                        â”‚                        â”‚
     â”‚                        â”‚  Le nouveau Host       â”‚
     â”‚                        â”‚  utilise sa copie      â”‚
     â”‚                        â”‚  locale comme          â”‚
     â”‚                        â”‚  rÃ©fÃ©rence             â”‚
     â”‚                        â”‚                        â”‚
     â”‚                        â”‚  GAME_STATE_SYNC       â”‚
     â”‚                        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
     â”‚                        â”‚ {players: [...],       â”‚
     â”‚                        â”‚  worldState: {...},    â”‚
     â”‚                        â”‚  timestamp: ...}       â”‚
     â”‚                        â”‚                        â”‚
     â”‚                        â”‚  MAJ Ã©tat local avec   â”‚
     â”‚                        â”‚  Ã©tat du nouveau Host  â”‚
     â”‚                        â”‚                        â”‚
     â”‚                        â”‚  Reprise de lâ€™autoritÃ© â”‚
     â”‚                        â”‚  sur dÃ©cisions         â”‚
     â”‚                        â”‚  critiques             â”‚
     â”‚                        â”‚                        â”‚
     â”‚                        â”‚  PARTIE CONTINUE       â”‚
     â”‚                        â”‚  normalement           â”‚
     â–¼                        â–¼                        â–¼

```

---

## NumÃ©rotation de sÃ©quence

```
    ProblÃ¨me: Ordre des messages

    Client 1 envoie:
    seq:100 â†’ pos:(10,5)
    seq:101 â†’ pos:(11,5)
    seq:102 â†’ pos:(12,5)

    Client 2 reÃ§oit dans le dÃ©sordre:
    seq:102 â†’ pos:(12,5) âœ… Applique
    seq:100 â†’ pos:(10,5) âŒ IGNORE (obsolÃ¨te)
    seq:101 â†’ pos:(11,5) âŒ IGNORE (obsolÃ¨te)


    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    â•‘  RÃˆGLE DE GESTION DES SÃ‰QUENCES                   â•‘
    â•‘                                                   â•‘
    â•‘  ğŸ“Š UN COMPTEUR PAR PAIR (last_seq[peerId])      â•‘
    â•‘                                                   â•‘
    â•‘  Chaque client maintient un dictionnaire:        â•‘
    â•‘  last_seq = {                                     â•‘
    â•‘    1: 78,   // DerniÃ¨re sÃ©quence reÃ§ue de J1     â•‘
    â•‘    2: 42,   // DerniÃ¨re sÃ©quence reÃ§ue de J2     â•‘
    â•‘    3: 95    // DerniÃ¨re sÃ©quence reÃ§ue de J3     â•‘
    â•‘  }                                                â•‘
    â•‘                                                   â•‘
    â•‘  Ã€ la rÃ©ception d'un paquet {from: i, seq: s}:   â•‘
    â•‘                                                   â•‘
    â•‘  1ï¸âƒ£  Si s <= last_seq[i]:                       â•‘
    â•‘     â†’ Paquet obsolÃ¨te ou dupliquÃ©                â•‘
    â•‘     â†’ IGNORER                                    â•‘
    â•‘                                                   â•‘
    â•‘  2ï¸âƒ£  Si s > last_seq[i]:                        â•‘
    â•‘     â†’ Paquet valide et rÃ©cent                    â•‘
    â•‘     â†’ APPLIQUER les modifications                â•‘
    â•‘     â†’ MAJ last_seq[i] = s                        â•‘
    â•‘                                                   â•‘
    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


    Exemple concret:

    Ã‰tat initial sur Client 3:
    last_seq = {1: 0, 2: 0}

    RÃ©ception des messages:

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ 1. Message de J1 {from:1, seq:5, pos:(10,20)}  â”‚
    â”‚    â†’ 5 > last_seq[1] (0)                        â”‚
    â”‚    â†’ APPLIQUE position J1                       â”‚
    â”‚    â†’ last_seq[1] = 5                            â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ 2. Message de J2 {from:2, seq:3, pos:(5,15)}   â”‚
    â”‚    â†’ 3 > last_seq[2] (0)                        â”‚
    â”‚    â†’ APPLIQUE position J2                       â”‚
    â”‚    â†’ last_seq[2] = 3                            â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ 3. Message de J1 {from:1, seq:3, pos:(8,18)}   â”‚
    â”‚    â†’ 3 <= last_seq[1] (5)                       â”‚
    â”‚    â†’ IGNORE (paquet ancien/retardÃ©)             â”‚
    â”‚    â†’ last_seq[1] reste Ã  5                      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ 4. Message de J2 {from:2, seq:4, pos:(6,16)}   â”‚
    â”‚    â†’ 4 > last_seq[2] (3)                        â”‚
    â”‚    â†’ APPLIQUE position J2                       â”‚
    â”‚    â†’ last_seq[2] = 4                            â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    Ã‰tat final:
    last_seq = {1: 5, 2: 4}


    âš ï¸  IMPORTANT - Gestion par pair
    
    âœ… CORRECT : Un compteur sÃ©parÃ© par joueur
    last_seq[1] = 100  // J1 Ã  seq 100
    last_seq[2] = 50   // J2 Ã  seq 50 (indÃ©pendant)
    
    âŒ INCORRECT : Un seul compteur global
    last_seq = 100
    â†’ Ignorerait tous les paquets de J2 avec seq < 100
      mÃªme si c'est normal pour J2
```

---

## Comparaison P2P vs Client-Serveur

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Client-Serveur    â”‚    Peer-to-Peer         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ AutoritÃ©: SERVEUR         â”‚ DistribuÃ©e/Host         â”‚
â”‚ Latence: Câ†’Sâ†’C (double)   â”‚ Câ†’C (directe)           â”‚
â”‚ Anti-triche: FORTE âœ…     â”‚ FAIBLE âŒ               â”‚
â”‚ Connexions: n             â”‚ nÃ—(n-1)/2               â”‚
â”‚ Serveur dÃ©diÃ©: OUI        â”‚ NON                     â”‚
â”‚ ScalabilitÃ©: BONNE        â”‚ LIMITÃ‰E (max 8)         â”‚
â”‚ TolÃ©rance panne: FAIBLE   â”‚ FORTE (migration)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    Client-Serveur:          Peer-to-Peer:
    
    C1 â”€â”€â”€â”                  C1 â”€â”€â”€ C2
          â”‚                   â”‚  â•²  â•± â”‚
          S                   â”‚   â•³   â”‚
          â”‚                   â”‚  â•±  â•² â”‚
    C2 â”€â”€â”€â”˜                  C3 â”€â”€â”€ C4
    
    2 clients = 2 connexions  4 clients = 6 connexions
```

---

## Conditions de validation

```

---

**Date** : 4 novembre 2025  
**Type** : Synchronisation Peer-to-Peer

