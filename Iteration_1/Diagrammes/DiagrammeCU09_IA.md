# Diagramme CU09 - GÃ©rer les Ennemis (IA)

---

## Machine Ã  Ã©tats de l'IA

```
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚              DÃ‰MARRAGE                           â”‚
                            â”‚                                                  â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                  â”‚
                                                  â–¼
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚            ğŸ”µ PATROUILLE                         â”‚
                            â”‚                                                  â”‚
                            â”‚  Actions:                                        â”‚
                            â”‚  â€¢ Suit un chemin prÃ©dÃ©fini                      â”‚
                            â”‚  â€¢ Regarde autour (rotation tÃªte)                â”‚
                            â”‚  â€¢ VÃ©rifie FOV en continu                        â”‚
                            â”‚                                                  â”‚
                            â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚                              â–²
                                 â”‚ Joueur dÃ©tectÃ©               â”‚
                                 â”‚                              â”‚
                                 â–¼                              â”‚
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚            ğŸŸ¡ ALERTE                            â”‚
                            â”‚                                                  â”‚
                            â”‚  Actions:                                        â”‚
                            â”‚  â€¢ S'arrÃªte immÃ©diatement                        â”‚
                            â”‚  â€¢ Rotation vers joueur                          â”‚
                            â”‚  â€¢ Timer: 1 seconde                              â”‚
                            â”‚                                                  â”‚
                            â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚                              â”‚
                                 â”‚ Fin timer 1s                 â”‚ Joueur non
                                 â”‚ ET joueur                    â”‚ dÃ©tectÃ© Ã  la
                                 â”‚ toujours                     â”‚ fin de 1s
                                 â”‚ dÃ©tectÃ©                      â”‚
                                 â”‚                              â”‚
                                 â–¼                              â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚                â”‚
                â”‚                â–¼
                â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚   â”‚            ğŸ”´ POURSUITE                           â”‚
                â”‚   â”‚                                                   â”‚
                â”‚   â”‚  Actions:                                         â”‚
                â”‚   â”‚  â€¢ Demande chemin via Pathfinding                 â”‚
                â”‚   â”‚  â€¢ Suit le chemin case par case                   â”‚
   Joueur non   â”‚   â”‚  â€¢ Recalcule si joueur bouge                      â”‚
   dÃ©tectÃ©      â”‚   â”‚  â€¢ Timer perte: incrÃ©mente si non dÃ©tectÃ©         â”‚
   pendant 5s   â”‚   â”‚                                                   â”‚
                â”‚   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚        â”‚                              â”‚
                â”‚        â”‚ Distance < 2m                â”‚ HP â‰¤ 0
                â”‚        â”‚                              â”‚
                â”‚        â–¼                              â–¼
                â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚   â”‚            âš”ï¸ ATTAQUE                             â”‚
                â””â”€â”€â”€â”¤                                                   â”‚
                    â”‚  Actions:                                         â”‚
                    â”‚  â€¢ Animation attaque                              â”‚
                    â”‚  â€¢ Inflige 20 HP toutes les 2s                    â”‚
                    â”‚  â€¢ Reste face au joueur                           â”‚
                    â”‚                                                   â”œâ”€â”€â”€â”€â”
                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
                         â”‚                              â”‚                    â”‚
                         â”‚ Distance â‰¥ 2m                â”‚ HP < 30%           â”‚
                         â”‚ ET joueur                    â”‚ OU                 â”‚
                         â”‚ toujours                     â”‚ DÃ©gÃ¢ts             â”‚
                         â”‚ dÃ©tectÃ©                      â”‚ trop               â”‚
                         â”‚                              â”‚ rapides            â”‚
                         â”‚                              â”‚                    â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚               â”‚
                                        â”‚               â–¼
                                        â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                        â”‚   â”‚        ğŸ’¨ FUITE                  â”‚
                                        â”‚   â”‚                                  â”‚
                                        â”‚   â”‚  Actions:                        â”‚
                                        â”‚   â”‚  â€¢ Demande chemin vers couvert   â”‚
                                        â”‚   â”‚    (Pathfinding)                 â”‚
                                        â”‚   â”‚  â€¢ S'Ã©loigne direction opposÃ©e   â”‚
                                        â”‚   â”‚  â€¢ Vitesse +20%                  â”‚
                                        â”‚   â”‚                                  â”‚
                                        â”‚   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚        â”‚              â”‚
                                        â”‚        â”‚ Distance > 15mâ”‚ HP â‰¤ 0
                                        â”‚        â”‚ ET zone sÃ»re â”‚
                                        â”‚        â”‚              â”‚
                                        â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                                        â”‚                       â”‚
                                        â–¼                       â–¼
                              Retour PATROUILLE     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              (tous les Ã©tats       â”‚        â˜ ï¸ MORT           â”‚
                              sauf MORT)            â”‚                          â”‚
                                                    â”‚  Actions:                â”‚
                                                    â”‚  â€¢ Animation mort        â”‚
                                                    â”‚  â€¢ DÃ©sactive IA          â”‚
                                                    â”‚  â€¢ DÃ©sactive collisions  â”‚
                                                    â”‚  â€¢ ArrÃªt pathfinding     â”‚
                                                    â”‚  â€¢ Destruction aprÃ¨s 2s  â”‚
                                                    â”‚  â€¢ LibÃ¨re ressources     â”‚
                                                    â”‚                          â”‚
                                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                             â”‚
                                                             â–¼
                                                        DÃ‰TRUIT

```

---

## ScÃ©nario : DÃ©tection et poursuite

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Joueur  â”‚          â”‚ Moteur Jeu   â”‚          â”‚  Ennemi IA   â”‚          â”‚ Pathfinding  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                      â”‚                          â”‚                          â”‚
     â”‚                      â”‚ Boucle de jeu update()   â”‚                          â”‚
     â”‚                      â”‚ (60 FPS)                 â”‚                          â”‚
     â”‚                      â”‚                          â”‚                          â”‚
     â”‚                      â”‚                          â”‚ Ã‰tat: PATROUILLE         â”‚
     â”‚                      â”‚                          â”‚ Se dÃ©place...            â”‚
     â”‚                      â”‚                          â”‚                          â”‚
     â”‚ Se dÃ©place           â”‚                          â”‚                          â”‚
     â”‚ Position: (x, y)     â”‚                          â”‚                          â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                          â”‚                          â”‚
     â”‚                      â”‚                          â”‚                          â”‚
     â”‚                      â”‚ update(deltaTime)        â”‚                          â”‚
     â”‚                      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                          â”‚
     â”‚                      â”‚                          â”‚                          â”‚
     â”‚                      â”‚                          â”‚ detecterJoueur()         â”‚
     â”‚                      â”‚                          â”‚ â€¢ Calcul angle           â”‚
     â”‚                      â”‚                          â”‚ â€¢ Calcul distance        â”‚
     â”‚                      â”‚                          â”‚ â€¢ Raycast obstacles      â”‚
     â”‚                      â”‚                          â”‚                          â”‚
     â”‚                      â”‚                          â”‚ DÃ©tection:               â”‚
     â”‚                      â”‚                          â”‚ â€¢ Angle: 45Â° < 60Â° âœ…    â”‚
     â”‚                      â”‚                          â”‚ â€¢ Distance: 8m < 10m âœ…  â”‚
     â”‚                      â”‚                          â”‚ â€¢ Pas obstacle âœ…        â”‚
     â”‚                      â”‚                          â”‚                          â”‚
     â”‚                      â”‚                          â”‚ Transition â†’ ALERTE      â”‚
     â”‚                      â”‚                          â”‚ ğŸš¨                       â”‚
     â”‚                      â”‚                          â”‚                          â”‚
     â”‚                      â”‚                          â”‚ Actions:                 â”‚
     â”‚                      â”‚                          â”‚ â€¢ arreterDeplacement()   â”‚
     â”‚                      â”‚                          â”‚ â€¢ rotationVers(joueur)   â”‚
     â”‚                      â”‚                          â”‚ â€¢ timerAlerte = 0        â”‚
     â”‚                      â”‚                          â”‚                          â”‚
     â”‚                      â”‚ Ã‰tat: ALERTE             â”‚                          â”‚
     â”‚                      â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                          â”‚
     â”‚                      â”‚                          â”‚                          â”‚
     â”‚ Ennemi s'arrÃªte      â”‚                          â”‚                          â”‚
     â”‚ et regarde           â”‚                          â”‚                          â”‚
     â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                          â”‚
     â”‚                      â”‚                          â”‚                          â”‚
     â”‚                      â”‚ update(deltaTime)        â”‚                          â”‚
     â”‚                      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                          â”‚
     â”‚                      â”‚                          â”‚                          â”‚
     â”‚                      â”‚                          â”‚ timerAlerte += dt        â”‚
     â”‚                      â”‚                          â”‚ (0.5s... 1.0s)           â”‚
     â”‚                      â”‚                          â”‚                          â”‚
     â”‚                      â”‚ update(deltaTime)        â”‚                          â”‚
     â”‚                      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                          â”‚
     â”‚                      â”‚                          â”‚                          â”‚
     â”‚                      â”‚                          â”‚ timerAlerte >= 1.0s âœ…   â”‚
     â”‚                      â”‚                          â”‚ detecterJoueur()         â”‚
     â”‚                      â”‚                          â”‚ Joueur toujours dÃ©tectÃ© âœ…â”‚
     â”‚                      â”‚                          â”‚                          â”‚
     â”‚                      â”‚                          â”‚ Transition â†’ POURSUITE   â”‚
     â”‚                      â”‚                          â”‚ ğŸƒ                       â”‚
     â”‚                      â”‚                          â”‚                          â”‚
     â”‚                      â”‚                          â”‚ demanderChemin(posJoueur)â”‚
     â”‚                      â”‚                          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
     â”‚                      â”‚                          â”‚                          â”‚
     â”‚                      â”‚                          â”‚                          â”‚ calculerChemin()
     â”‚                      â”‚                          â”‚                          â”‚ Algorithme: BFS
     â”‚                      â”‚                          â”‚                          â”‚ Graphe: cases
     â”‚                      â”‚                          â”‚                          â”‚ walkable
     â”‚                      â”‚                          â”‚                          â”‚
     â”‚                      â”‚                          â”‚ retourChemin([Aâ†’Bâ†’Câ†’D])  â”‚
     â”‚                      â”‚                          â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚                      â”‚                          â”‚                          â”‚
     â”‚                      â”‚                          â”‚ sauvegarderChemin()      â”‚
     â”‚                      â”‚                          â”‚ indexCase = 0            â”‚
     â”‚                      â”‚                          â”‚                          â”‚
     â”‚                      â”‚ update(deltaTime)        â”‚                          â”‚
     â”‚                      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                          â”‚
     â”‚                      â”‚                          â”‚                          â”‚
     â”‚                      â”‚                          â”‚ suivreChemin()           â”‚
     â”‚                      â”‚                          â”‚ DÃ©place vers case B      â”‚
     â”‚                      â”‚                          â”‚ Vitesse: 3 m/s           â”‚
     â”‚                      â”‚                          â”‚                          â”‚
     â”‚ Ennemi court         â”‚                          â”‚                          â”‚
     â”‚ vers joueur          â”‚ Ã‰tat: POURSUITE          â”‚                          â”‚
     â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                          â”‚
     â”‚                      â”‚                          â”‚                          â”‚
     â”‚                      â”‚ update(deltaTime)        â”‚                          â”‚
     â”‚                      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                          â”‚
     â”‚                      â”‚                          â”‚                          â”‚
     â”‚                      â”‚                          â”‚ suivreChemin()           â”‚
     â”‚                      â”‚                          â”‚ DÃ©place vers case C      â”‚
     â”‚                      â”‚                          â”‚ Distance: 5m... 3m...    â”‚
     â”‚                      â”‚                          â”‚                          â”‚
     â”‚ Ennemi se            â”‚                          â”‚                          â”‚
     â”‚ rapproche            â”‚                          â”‚                          â”‚
     â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                          â”‚
     â”‚                      â”‚                          â”‚                          â”‚
     â–¼                      â–¼                          â–¼                          â–¼
                     â–¼
```

---

## ScÃ©nario alternatif : Ennemi bloquÃ©

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Ennemi  â”‚          â”‚ Pathfinding  â”‚          â”‚ Moteur Jeu   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                      â”‚                          â”‚
     â”‚ Ã‰tat: POURSUITE      â”‚                          â”‚
     â”‚ Joueur dÃ©tectÃ© âœ…    â”‚                          â”‚
     â”‚                      â”‚                          â”‚
     â”‚ demanderChemin()     â”‚                          â”‚
     â”‚ Tentative: 1/3       â”‚                          â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                          â”‚
     â”‚                      â”‚                          â”‚
     â”‚                      â”‚ calculerChemin()         â”‚
     â”‚                      â”‚ Algorithme: BFS          â”‚
     â”‚                      â”‚                          â”‚
     â”‚                      â”‚ Exploration graphe...    â”‚
     â”‚                      â”‚ Obstacle bloquant âŒ     â”‚
     â”‚                      â”‚ (mur, porte fermÃ©e)      â”‚
     â”‚                      â”‚                          â”‚
     â”‚ retourChemin(NULL)   â”‚                          â”‚
     â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                          â”‚
     â”‚                      â”‚                          â”‚
     â”‚ Chemin invalide      â”‚                          â”‚
     â”‚ nbRetries = 1        â”‚                          â”‚
     â”‚                      â”‚                          â”‚
     â”‚ demanderChemin()     â”‚                          â”‚
     â”‚ Tentative: 2/3       â”‚                          â”‚
     â”‚ (algorithme alternatif)â”‚                        â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                          â”‚
     â”‚                      â”‚                          â”‚
     â”‚                      â”‚ calculerChemin()         â”‚
     â”‚                      â”‚ Algorithme: A*           â”‚
     â”‚                      â”‚                          â”‚
     â”‚                      â”‚ Exploration graphe...    â”‚
     â”‚                      â”‚ Toujours bloquÃ© âŒ       â”‚
     â”‚                      â”‚                          â”‚
     â”‚ retourChemin(NULL)   â”‚                          â”‚
     â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                          â”‚
     â”‚                      â”‚                          â”‚
     â”‚ Chemin invalide      â”‚                          â”‚
     â”‚ nbRetries = 2        â”‚                          â”‚
     â”‚                      â”‚                          â”‚
     â”‚ demanderChemin()     â”‚                          â”‚
     â”‚ Tentative: 3/3       â”‚                          â”‚
     â”‚ (chemin direct)      â”‚                          â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                          â”‚
     â”‚                      â”‚                          â”‚
     â”‚                      â”‚ calculerChemin()         â”‚
     â”‚                      â”‚ Algorithme: ligne droiteâ”‚
     â”‚                      â”‚                          â”‚
     â”‚                      â”‚ VÃ©rifie obstacles...     â”‚
     â”‚                      â”‚ Toujours bloquÃ© âŒ       â”‚
     â”‚                      â”‚                          â”‚
     â”‚ retourChemin(NULL)   â”‚                          â”‚
     â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                          â”‚
     â”‚                      â”‚                          â”‚
     â”‚ Chemin invalide      â”‚                          â”‚
     â”‚ nbRetries = 3        â”‚                          â”‚
     â”‚ Limite atteinte âœ…   â”‚                          â”‚
     â”‚                      â”‚                          â”‚
     â”‚ abandonPoursuite()   â”‚                          â”‚
     â”‚ Raison: "Cible       â”‚                          â”‚
     â”‚ inaccessible"        â”‚                          â”‚
     â”‚                      â”‚                          â”‚
     â”‚ vÃ©rifierConditions() â”‚                          â”‚
     â”‚ Joueur toujours      â”‚                          â”‚
     â”‚ dÃ©tectÃ© mais         â”‚                          â”‚
     â”‚ inaccessible         â”‚                          â”‚
     â”‚                      â”‚                          â”‚
     â”‚ dÃ©cision:            â”‚                          â”‚
     â”‚ "Abandon poursuite   â”‚                          â”‚
     â”‚ car aucun chemin     â”‚                          â”‚
     â”‚ trouvable"           â”‚                          â”‚
     â”‚                      â”‚                          â”‚
     â”‚ Transition â†’ PATROUILLE                         â”‚
     â”‚ ğŸ”µ                   â”‚                          â”‚
     â”‚                      â”‚                          â”‚
     â”‚ Actions:             â”‚                          â”‚
     â”‚ â€¢ rÃ©initialiserTimer()                          â”‚
     â”‚ â€¢ effacerCible()     â”‚                          â”‚
     â”‚ â€¢ reprendreRoute()   â”‚                          â”‚
     â”‚                      â”‚                          â”‚
     â”‚ Ã‰tat: PATROUILLE     â”‚                          â”‚
     â”‚                      â”‚                          â”‚
     â”‚ update()             â”‚                          â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
     â”‚                      â”‚                          â”‚
     â”‚                      â”‚                          â”‚ Tick frame
     â”‚                      â”‚                          â”‚ (60 FPS)
     â”‚                      â”‚                          â”‚
     â”‚ Ã‰tat confirmÃ© âœ…     â”‚                          â”‚
     â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚                      â”‚                          â”‚
     â–¼                      â–¼                          â–¼

```

---

## ScÃ©nario : Attaque et fuite

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Joueur  â”‚                    â”‚  Ennemi IA   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                                â”‚
     â”‚                                â”‚ Ã‰tat: POURSUITE
     â”‚                                â”‚
     â”‚ Distance = 1.5m                â”‚
     â”‚ (assez proche)                 â”‚
     â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚                                â”‚
     â”‚                                â”‚ Transition â†’ ATTAQUE
     â”‚                                â”‚ âš”ï¸
     â”‚                                â”‚
     â”‚ ReÃ§oit dÃ©gÃ¢ts -20 HP           â”‚ Inflige dÃ©gÃ¢ts
     â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ Timer: toutes les 2s
     â”‚                                â”‚
     â”‚ Riposte (tire)                 â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
     â”‚                                â”‚
     â”‚                                â”‚ ReÃ§oit dÃ©gÃ¢ts -25 HP
     â”‚                                â”‚ HP: 100â†’75â†’50â†’25
     â”‚                                â”‚
     â”‚                                â”‚ Condition FUITE:
     â”‚                                â”‚ HP < 30% âœ…
     â”‚                                â”‚
     â”‚                                â”‚ Transition â†’ FUITE
     â”‚                                â”‚ ğŸƒğŸ’¨
     â”‚                                â”‚
     â”‚ Ennemi s'enfuit                â”‚
     â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ Calcule direction
     â”‚                                â”‚ opposÃ©e au joueur
     â”‚                                â”‚
     â”‚                                â”‚ Court vers couvert
     â”‚                                â”‚
     â”‚                                â”‚ Distance > 15m
     â”‚                                â”‚ SÃ©curisÃ© âœ…
     â”‚                                â”‚
     â”‚                                â”‚ Retour â†’ PATROUILLE
     â”‚                                â”‚
     â–¼                                â–¼
```

---

## Algorithme de pathfinding

```
    Demande de chemin
    
    Ennemi (x1,y1) â”€â”€â”€â”€â–º Joueur (x2,y2)
    
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Algorithme BFS    â”‚
    â”‚  ou Dijkstra       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚ Exploration du graphe
              â”‚
         â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
         â”‚         â”‚
      TrouvÃ©?   BloquÃ©?
         â”‚         â”‚
         â–¼         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Chemin â”‚ â”‚  NULL  â”‚
    â”‚ [Aâ†’Bâ†’C]â”‚ â”‚        â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
         â”‚         â”‚
         â”‚         â”‚ RÃ©essai ou
         â”‚         â”‚ Abandon
         â”‚         â”‚
         â–¼         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Ennemi suit      â”‚
    â”‚ le chemin        â”‚
    â”‚ case par case    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## DÃ©tection du joueur

```
    Champ de vision (FOV)
    
              Ennemi ğŸ‘¾
                 â–²
                 â”‚
          â•±â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â•²
        â•±    120Â°â”‚       â•²
      â•±          â”‚         â•²
    â•±            â”‚           â•²
   â”‚             â”‚            â”‚
   â”‚     Zone    â”‚   Zone     â”‚
   â”‚   visible   â”‚  visible   â”‚
   â”‚             â”‚            â”‚
   â”‚             â”‚            â”‚
   â”‚             â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
   â”‚          Joueur          â”‚
   â”‚          (dÃ©tectÃ© âœ…)    â”‚
   â”‚                          â”‚
    â•²                        â•±
      â•²                    â•±
        â•²                â•±
          â•²â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•±
          
    Distance max: 10 mÃ¨tres
    
    
    Conditions de dÃ©tection:
    
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ 1. Angle < 60Â° (Â±60Â°)   â”‚
    â”‚    depuis direction     â”‚
    â”‚    de l'ennemi          â”‚
    â”‚                         â”‚
    â”‚ 2. Distance < 10m       â”‚
    â”‚                         â”‚
    â”‚ 3. Pas d'obstacle       â”‚
    â”‚    entre les deux       â”‚
    â”‚    (raycast)            â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```

---

**Date** : 4 novembre 2025  
**CU** : CU09 - GÃ©rer les ennemis (IA)

